<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8">

    <title>Sensor Reboot Panel</title>



    <style>

        :root {

            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

            color: #000;

            background-color: #f5f5f5;

        }



        * { box-sizing: border-box; }



        body {

            margin: 0;

            min-height: 100vh;

            display: flex;

            justify-content: center;

            align-items: flex-start;

            padding: 40px 16px;

        }



        .shell {

            background: #ffffff;

            border: 1px solid #000;

            border-radius: 18px;

            padding: 24px 28px 28px;

            max-width: 1100px;

            width: 100%;

            box-shadow: 0 10px 30px rgba(0,0,0,0.08);

        }



        /* Header */

        .header {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 24px;

        }



        .title-block h1 {

            margin: 0;

            font-size: 22px;

            letter-spacing: 0.14em;

            text-transform: uppercase;

        }



        .logo-placeholder {

            width: 120px;

            height: 40px;

            display: flex;

            align-items: center;

            justify-content: flex-end;

        }



        .logo-placeholder img {

            max-height: 38px;

            max-width: 100%;

            object-fit: contain;

        }



        /* Top links */

        .top-links {

            font-size: 12px;

            margin-bottom: 20px;

        }



        .top-links a {

            margin-right: 14px;

            text-decoration: none;

            color: #000;

            font-weight: 500;

            border-bottom: 1px solid transparent;

        }



        .top-links a:hover {

            border-bottom-color: #000;

        }



        /* Grid */

        .grid {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));

            gap: 18px;

        }



        .card {

            border: 1px solid #000;

            border-radius: 16px;

            padding: 18px;

            background: #fafafa;

            display: flex;

            flex-direction: column;

            justify-content: space-between;

        }



        .card-title {

            font-size: 14px;

            letter-spacing: 0.08em;

            text-transform: uppercase;

            margin-bottom: 16px;

            font-weight: 600;

        }



        .btn {

            border-radius: 999px;

            border: 1px solid #000;

            background: #000;

            color: #fff;

            padding: 9px 18px;

            cursor: pointer;

            font-size: 11px;

            letter-spacing: 0.14em;

            text-transform: uppercase;

            width: fit-content;

        }



        .btn[disabled] {

            opacity: 0.4;

            cursor: not-allowed;

        }



        .status {

            font-size: 12px;

            min-height: 1em;

            margin-top: 10px;

        }



        .status.progress {

            font-style: italic;

        }



        .status.ok {

            font-weight: 600;

        }



        .status.error {

            color: #b00020;

        }



        @media (max-width: 600px) {

            body {

                padding: 16px;

            }

            .shell {

                padding: 18px;

            }

        }

    </style>

</head>



<body>

<div class="shell">



    <!-- Header -->

    <header class="header">

        <div class="title-block">

            <h1>Sensor Reboot Panel</h1>

        </div>

        <div class="logo-placeholder">

            <img src="{{ url_for('static', filename='logo.png') }}" alt="Company Logo">

        </div>

    </header>



    <!-- Top navigation -->

    <div class="top-links">

        {% if session.user.role == 'superadmin' %}

            <a href="{{ url_for('manage_users') }}">Admin Panel</a>

        {% endif %}

        <a href="{{ url_for('logout') }}">Logout</a>

    </div>



    <!-- Sensor cards -->

    <section class="grid">

        {% for sensor in sensors %}

        <article class="card" data-id="{{ sensor.id }}">

            <div class="card-title">{{ sensor.name }}</div>



            <button class="btn reboot-btn">Reboot</button>



            <div class="status" id="status-{{ sensor.id }}"></div>

        </article>

        {% endfor %}

    </section>



</div>



<!-- Reboot logic -->

<script>

document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll(".card").forEach(card => {

        const id = card.getAttribute("data-id");

        const btn = card.querySelector(".reboot-btn");

        const status = document.getElementById("status-" + id);



        btn.addEventListener("click", async () => {

            if (!confirm("Are you sure you want to reboot this sensor?")) return;



            btn.disabled = true;

            status.className = "status progress";

            status.innerText = "Reboot in progress...";



            try {

                const res = await fetch("/reboot/" + id, { method: "POST" });

                const data = await res.json();



                if (res.ok && data.status === "ok") {

                    status.className = "status ok";

                    status.innerText = "Reboot completed";

                } else {

                    status.className = "status error";

                    status.innerText = "Failed: " + (data.details || "unknown error");

                }

            } catch (e) {

                status.className = "status error";

                status.innerText = "Request failed";

            } finally {

                setTimeout(() => {

                    btn.disabled = false;

                }, 5000);

            }

        });

    });

});

</script>



<!-- Inactivity auto logout (15 minutes) -->

<script>

let inactivityTimer;



function resetInactivityTimer() {

    clearTimeout(inactivityTimer);

    inactivityTimer = setTimeout(() => {

        window.location.href = "/logout";

    }, 15 * 60 * 1000); // 15 minutes

}



["mousemove", "keydown", "click", "scroll"].forEach(event => {

    document.addEventListener(event, resetInactivityTimer);

});



resetInactivityTimer();

</script>



</body>

</html>
